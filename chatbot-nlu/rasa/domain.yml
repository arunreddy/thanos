# domain.yml
version: "3.1"

intents:
  - greet
  - goodbye
  - help
  - help_website
  - restart
  - recommend_database
  - create_database
  - delete_database
  - out_of_scope
  - inform_database_version 
  - confirm_database_selection
  - affirm
  - deny

entities:
  - database_name
  - database_instance
  - database_version
  - sysid

forms:
  recommend_database_form:
    required_slots:
      - app_type
      - feature_type
      - relationship_type
      - downtime_tolerance

  create_database_form:
    required_slots:
      - database_name
      - database_version
      - sysid

  delete_database_form:
    required_slots:
      - database_name
      - database_instance 
      - sysid

slots:
  # — select-database form slots —
  app_type:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: recommend_database_form
            requested_slot: app_type

  feature_type:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: recommend_database_form
            requested_slot: feature_type

  relationship_type:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: recommend_database_form
            requested_slot: relationship_type

  downtime_tolerance:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: recommend_database_form
            requested_slot: downtime_tolerance

  # — create/delete-database form slots —
  database_name:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: create_database_form
            requested_slot: database_name
          - active_loop: delete_database_form
            requested_slot: database_name

  database_version:
    type: text
    mappings:
      - type: from_entity    # pull from the inform_database_version intent
        entity: database_version
        conditions:
          - active_loop: create_database_form
            requested_slot: database_version
      - type: from_text
        conditions:
          - active_loop: create_database_form
            requested_slot: database_version

  database_instance:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: delete_database_form
            requested_slot: database_instance 

  sysid:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: create_database_form
            requested_slot: sysid
          - active_loop: delete_database_form
            requested_slot: sysid

  # — output slots for recommendation flow —
  recommended_database:
    type: text
    influence_conversation: false
    mappings: []

  estimated_cost:
    type: text
    influence_conversation: false
    mappings: []

  confirmed:
    type: bool
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: true
        conditions:
          - active_loop: null
            requested_slot: null
      - type: from_intent
        intent: deny
        value: false
        conditions:
          - active_loop: null
            requested_slot: null


responses:
  utter_greet:
    - text: "Hello! How can I help you today?"

  utter_goodbye:
    - text: "Goodbye! Have a nice day."

  utter_help:
    - text: |
        I can help you:
        • Recommend a database  
        • Create a new database  
        • Delete an existing database  
        What would you like to do?
      buttons:
        - title: "Recommend a Database"
          payload: "/recommend_database"
        - title: "Create Database"
          payload: "/create_database"
        - title: "Delete Database"
          payload: "/delete_database"

  utter_help_website:
    - text: |
        Here’s what I can do:
        1. Recommend a database.  
        2. Provision (create) a new database.  
        3. Decommission (delete) a database.

  # — select-database form prompts —
  utter_ask_app_type:
    - text: "What best describes your setup?"
      buttons:
        - title: "Structured data, vendor app"
          payload: "Structured data, vendor app"
        - title: "Structured data, home-grown app"
          payload: "Structured data, home-grown app"
        - title: "Unstructured data, vendor app"
          payload: "Unstructured data, vendor app"
        - title: "Unstructured data, home-grown app"
          payload: "Unstructured data, home-grown app"

  utter_ask_feature_type:
    - text: "Any special features? (full-text search, embeddings, nested docs, etc.)"
      buttons:
        - title: "Yes, Oracle-only"
          payload: "Yes, Oracle-only"
        - title: "Yes, but flexible"
          payload: "Yes, but flexible on database"
        - title: "No special features"
          payload: "No special features needed"

  utter_ask_relationship_type:
    - text: "Do you need single-key access, complex relationships, or none?"
      buttons:
        - title: "Single-key access only"
          payload: "Single-key access only"
        - title: "Complex relationships/schema"
          payload: "Complex relationships or relational schema"
        - title: "None"
          payload: "None of these"

  utter_ask_downtime_tolerance:
    - text: "Can your app tolerate about an hour of downtime?"
      buttons:
        - title: "Yes"
          payload: "Yes"
        - title: "No"
          payload: "No"

  # — final submit for recommendation —
  utter_request_submitted:
    - text: "Based on your responses, we recommend {recommended_database} (≈{estimated_cost}). A Jira ticket has been created."

  # — create-database form prompts —
  utter_ask_database_name:
    - text: "Could you please provide the name of the database."


  utter_ask_database_version:
      - text: "Which version do you need?"
        buttons:
          - title: "PostgreSQL 13"
            payload: '/inform_database_version{"database_version":"postgresql13"}'
          - title: "PostgreSQL 14"
            payload: '/inform_database_version{"database_version":"postgresql14"}'
          - title: "PostgreSQL 15"
            payload: '/inform_database_version{"database_version":"postgresql15"}'
          - title: "PostgreSQL 16"
            payload: '/inform_database_version{"database_version":"postgresql16"}'

  utter_ask_sysid:
    - text: "Please provide the SYSID for your database."

  utter_submit_database:
    - text: "Your request to create {database_name} ({database_version}) with SYSID {sysid} has been submitted!"

  utter_ask_confirm_database_creation:
    - text: "You're about to create a database with these details:\n\n- Name: {database_name}\n- Version: {database_version}\n- SYSID: {sysid}\n\nWould you like to proceed with this database creation?"
      buttons:
        - title: "Yes, create the database"
          payload: "/affirm"
        - title: "No, start over"
          payload: "/deny"

  # — delete-database confirmation —
  utter_confirm_delete_database:
    - text: "Your request to delete {database_name} ({database_version}) with SYSID {sysid} has been submitted!"
  
  utter_ask_database_instance:
    - text: "Please provide the database instance you want to delete."

  utter_ask_confirm_database_deletion:
    - text: |
        You're about to delete a database with these details:
        - Name: {database_name}
        - Instance: {database_instance}
        - SysID: {sysid}

        Are you sure you want to proceed?
      buttons:
        - title: "Yes, delete it"
          payload: "/affirm"
        - title: "No, cancel"
          payload: "/deny"

  utter_database_creation_cancelled:
    - text: "Database creation has been cancelled. What would you like to do next?"
      buttons:
        - title: "Try again"
          payload: "/create_database"
        - title: "Help"
          payload: "/help"

  utter_oos:
    - text: "I'm sorry, I don't understand that request or it's outside the scope of what I can do. I'm primarily designed to help with database-related tasks like selecting, creating, or deleting databases. Could you try asking me about one of these topics instead?"
      buttons:
        - title: "Select Database"
          payload: "/start_database_selection"
        - title: "Create Database"
          payload: "/create_database"
        - title: "Delete Database"
          payload: "/delete_database"
        - title: "Help"
          payload: "/help"

  utter_database_selection_confirmation:
    - text: "Would you like to proceed with this recommendation?"
      buttons:
        - title: "Yes, create ticket"
          payload: "/confirm_database_selection"
        - title: "No, let's try again"
          payload: "/restart"

actions:
  - action_recommend_database
  - action_recommend_database_create_ticket
  - action_submit_database
  - action_submit_delete_database
  - action_restart
  - validate_create_database_form
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false
