# domain.yml
version: "3.1"

intents:
  - greet
  - goodbye
  - help
  - help_website
  - restart
  - start_database_selection
  - create_database
  - delete_database

entities:
  - database_name
  - database_version
  - sysid

forms:
  select_database_form:
    required_slots:
      - app_type
      - feature_type
      - relationship_type
      - downtime_tolerance

  create_database_form:
    required_slots:
      - database_name
      - database_version
      - sysid

  delete_database_form:
    required_slots:
      - database_name
      - database_version
      - sysid

slots:
  # — select-database form slots —
  app_type:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: select_database_form
            requested_slot: app_type

  feature_type:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: select_database_form
            requested_slot: feature_type

  relationship_type:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: select_database_form
            requested_slot: relationship_type

  downtime_tolerance:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: select_database_form
            requested_slot: downtime_tolerance

  # — create/delete-database form slots —
  database_name:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: create_database_form
            requested_slot: database_name
          - active_loop: delete_database_form
            requested_slot: database_name

  database_version:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: create_database_form
            requested_slot: database_version
          - active_loop: delete_database_form
            requested_slot: database_version

  sysid:
    type: text
    mappings:
      - type: from_text
        conditions:
          - active_loop: create_database_form
            requested_slot: sysid
          - active_loop: delete_database_form
            requested_slot: sysid

  # — output slots for recommendation flow —
  recommended_database:
    type: text
    influence_conversation: false
    mappings: []

  estimated_cost:
    type: text
    influence_conversation: false
    mappings: []

responses:
  utter_greet:
    - text: "Hello! How can I help you today?"

  utter_goodbye:
    - text: "Goodbye! Have a nice day."

  utter_help:
    - text: |
        I can help you:
        • Select a database  
        • Create a new database  
        • Delete an existing database  
        What would you like to do?
      buttons:
        - title: "Select Database"
          payload: "/start_database_selection"
        - title: "Create Database"
          payload: "/create_database"
        - title: "Delete Database"
          payload: "/delete_database"

  utter_help_website:
    - text: |
        Here’s what I can do:
        1. Recommend a database.  
        2. Provision (create) a new database.  
        3. Decommission (delete) a database.

  # — select-database form prompts —
  utter_ask_app_type:
    - text: "What best describes your setup?"
      buttons:
        - title: "Structured data, vendor app"
          payload: "Structured data, vendor app"
        - title: "Structured data, home-grown app"
          payload: "Structured data, home-grown app"
        - title: "Unstructured data, vendor app"
          payload: "Unstructured data, vendor app"
        - title: "Unstructured data, home-grown app"
          payload: "Unstructured data, home-grown app"

  utter_ask_feature_type:
    - text: "Any special features? (full-text search, embeddings, nested docs, etc.)"
      buttons:
        - title: "Yes, Oracle-only"
          payload: "Yes, Oracle-only"
        - title: "Yes, but flexible"
          payload: "Yes, but flexible on database"
        - title: "No special features"
          payload: "No special features needed"

  utter_ask_relationship_type:
    - text: "Do you need single-key access, complex relationships, or none?"
      buttons:
        - title: "Single-key access only"
          payload: "Single-key access only"
        - title: "Complex relationships/schema"
          payload: "Complex relationships or relational schema"
        - title: "None"
          payload: "None of these"

  utter_ask_downtime_tolerance:
    - text: "Can your app tolerate about an hour of downtime?"
      buttons:
        - title: "Yes"
          payload: "Yes"
        - title: "No"
          payload: "No"

  # — final submit for recommendation —
  utter_request_submitted:
    - text: "Based on your responses, we recommend {recommended_database} (≈{estimated_cost}). A Jira ticket has been created."

  # — create-database form prompts —
  utter_ask_database_name:
    - text: "Provide the name of the database."

  utter_ask_database_version:
    - text: "Which version do you need?"
      buttons:
        - title: "PostgreSQL13"
          payload: "PostgreSQL13"
        - title: "PostgreSQL14"
          payload: "PostgreSQL14"
        - title: "PostgreSQL15"
          payload: "PostgreSQL15"
        - title: "PostgreSQL16"
          payload: "PostgreSQL16"

  utter_ask_sysid:
    - text: "Please provide the SysID for your database."

  utter_submit_database:
    - text: "Your request to create {database_name} ({database_version}) with SysID {sysid} has been submitted!"

  # — delete-database confirmation —
  utter_confirm_delete_database:
    - text: "Your request to delete {database_name} ({database_version}) with SysID {sysid} has been submitted!"

actions:
  - action_recommend_database
  - action_submit_request
  - action_submit_database
  - action_submit_delete_database
  - action_restart

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false
